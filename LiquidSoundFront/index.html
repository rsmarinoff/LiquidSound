<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <!--script src="https://code.jquery.com/jquery-1.12.0.min.js"></script-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link href="css/HoldOn.min.css" rel="stylesheet">
    <script src="js/HoldOn.min.js"></script>
</head>
<body>

<div class="container">
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Upload a song</h4>
                </div>
                <div class="modal-body">
                    <input type = text id="songTitle" />
                    <p>Title</p>
                    <input type = text id="artist" />
                    <p>Artist</p>
                    <input type = text id="genre" />
                    <p>Genre</p>
                </div>
                <div class="modal-footer">
                    <input type="file" id="file-input" />
                    <button type="button" class="btn btn-default" id="upload">Upload</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container text-center" style="margin-top:1em;">
    <div class="row">
        <div class="col-sm-3 well">
            <div class="well">
                <input type = text id="userName" />
                <p>Username</p>
                <input type = text id="password" />
                <p>Password</p>
                <button type="button" class="btn btn-default" id="login">Log In</button>
            </div>
            <div class="alert alert-success fade in">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">Ã—</a>
                <p><strong>Ey!</strong></p>
                People are looking at your profile. Find out who.
            </div>
            <p><a href="#">Link</a></p>
            <p><a href="#">Link</a></p>
            <p><a href="#">Link</a></p>
        </div>
        <div id = "playlist" class="col-sm-7">

            <div class="row">
                <div class="col-sm-12">
                        <nav class="navbar navbar-default">
                            <ul class="nav navbar-nav navbar-left" style="margin-left: 1em;">
                                <li><button type="button" class="btn btn-success navbar-btn" id="play"><span class="glyphicon glyphicon-play"></span></button></li>
                                <li><button type="button" class="btn btn-warning navbar-btn" id="pause"><span class="glyphicon glyphicon-pause"></span></button></li>
                                <li><button type="button" class="btn btn-danger navbar-btn" id="restart"><span class="glyphicon glyphicon-repeat"></span></button></li>
                            </ul>
                            <p class="navbar-text" id="currentTime">00:00 / 00:00</p>
                            <p class="navbar-text" id="title">n/a</p>
                            <p class="navbar-text" id="status" style="color:red;">Loading</p>
                            <p class="navbar-text" id="source">n/a</p>
                            <ul class="nav navbar-nav pull-right" style="margin-right: 1em;">
                                <li><button type="button" class="btn btn-primary navbar-btn" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-cloud-upload"></span></button></li>
                            </ul>
                        </nav>
                </div>
            </div>
        </div>
        <div class="col-sm-2 well">
            <div class="thumbnail">
                <p>Upcoming Events:</p>
                <img src="paris.jpg" alt="Paris" width="400" height="300">
                <p><strong>Paris</strong></p>
                <p>Fri. 27 November 2015</p>
                <button class="btn btn-primary">Info</button>
            </div>
            <div class="well">
                <p>ADS</p>
            </div>
            <div class="well">
                <p>ADS</p>
            </div>
        </div>
    </div>
</div>

<footer class="container-fluid text-center">
    <p>Footer Text</p>
</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>

<script>
    $(document).ready(function() {
        var audioElement = document.createElement('audio');
        audioElement.setAttribute('src', 'http://localhost:8084/liquidsound/songs/3');
        audioElement.addEventListener('ended', function() {
            this.play();
        }, false);

        audioElement.addEventListener("canplay",function(){
            $("#length").text("Duration:" + audioElement.duration + " seconds");
            $("#source").text("Source:" + audioElement.src);
            $("#status").text("Status: Ready to play").css("color","green");
            $("#currentTime").text(formatTime(audioElement.currentTime) + " / " + formatTime(audioElement.duration));
        });

        audioElement.addEventListener("timeupdate",function(){
            $("#currentTime").text(formatTime(audioElement.currentTime) + " / " + formatTime(audioElement.duration));
        });

        $('#play').click(function() {
            audioElement.play();
            $("#status").text("Status: Playing");
        });

        $('#pause').click(function() {
            audioElement.pause();
            $("#status").text("Status: Paused");
        });

        $('#restart').click(function() {
            audioElement.currentTime = 0;
        });
        getSongs(audioElement);
    });

    function getSongs(audioElement){
        var data = null;

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function () {
            if (this.readyState === 4) {
                console.log(this.responseText);
                var resp = JSON.parse(this.responseText);
                var i;
                for (i = 0; i < resp.length; i++) {

                    var row = document.createElement("div");
                    row.className = "row";
                    var column = document.createElement("div");
                    column.className = "col-sm-9";
                    var well = document.createElement("div");
                    well.onclick = function clicked(){
                        audioElement.setAttribute('src', 'http://localhost:8084/liquidsound/songs/'.concat(this.id));
                        audioElement.pause();
                        audioElement.play();
                    };
                    well.id = resp[i].id;
                    well.className = "well";
                    column.appendChild(well);

                    var paragraph = document.createElement("p");
                    var text = document.createTextNode(resp[i].artist);
                    text.appendData(" - ");
                    text.appendData(resp[i].name);

                    paragraph.appendChild(text);
                    well.appendChild(paragraph);

                    var smallColumn = document.createElement("div");
                    smallColumn.className = "col-sm-3";
                    var smallWell = document.createElement("div");
                    smallWell.className = "well";
                    smallColumn.appendChild(smallWell);

                    var smallParagraph = document.createElement("p");
                    var smallText = document.createTextNode(resp[i].genre);

                    smallParagraph.appendChild(smallText);
                    smallWell.appendChild(smallParagraph);

                    row.appendChild(smallColumn);
                    row.appendChild(column);

                    document.getElementById("playlist").appendChild(row);
                }
            }
        });
        xhr.open("GET", "http://localhost:8084/liquidsound/songs");
        xhr.setRequestHeader("cache-control", "no-cache");
        xhr.send(data);
    }

    $('#upload').click(function() {
        var options = {
            theme:"sk-bounce",
            message:' Processing your request... Please, remain calm.... ',
            textColor:"white"
        };
        HoldOn.open(options);
        var data = $('#file-input')[0].files[0];

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function () {
            if (this.readyState === 4) {
                console.log(this.responseText);
                var resp = JSON.parse(this.responseText);
                $('#myModal').modal('toggle');
                location.reload();
                HoldOn.close();
            }
        });

        xhr.open("POST", "http://localhost:8084/liquidsound/upload");
        xhr.setRequestHeader("content-type", "audio/mpeg");
        xhr.setRequestHeader("filename", $('#file-input')[0].value);
        xhr.setRequestHeader("name", $('#songTitle')[0].value);
        xhr.setRequestHeader("artist", $('#artist')[0].value);
        xhr.setRequestHeader("genre", $('#genre')[0].value);
        xhr.send(data);
    });

    $('#login').click(function() {
        var data = null;
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function () {
            if (this.readyState === 4) {
                console.log(this.responseText);
                alert("logged in")
            }
        });
        xhr.open("GET", "http://localhost:8084/liquidsound/");
        xhr.setRequestHeader("authorization", "Basic " + btoa("admin:admin"));
        xhr.setRequestHeader("cache-control", "no-cache");
        xhr.send(data);
    });
    function formatTime(seconds) {
        if(seconds == null){
            seconds = 0;
        }
        var minutes = Math.floor(seconds / 60);
        minutes = (minutes >= 10) ? minutes : "0" + minutes;
        seconds = Math.floor(seconds % 60);
        seconds = (seconds >= 10) ? seconds : "0" + seconds;
        return minutes + ":" + seconds;
    }
</script>
</body>
</html>
